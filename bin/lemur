#!/bin/bash

#
# WORK IN PROGRESS
#

if [ -z "$JAVA_HOME" ]; then
  echo Exiting: environment variable JAVA_HOME must be set
  exit 1
fi

JAVA=$JAVA_HOME/bin/java

BASE=`dirname $0`/..
BASE=`cd $BASE; pwd -P`

# TODO this will need to change to be Generic (non-TCC specific)

# TODO need to be able to inject your organizations' classpath, one option:
#   LEMUR_ORG_CP=blah; bin/lemur ...
#   And this script would override _ORG_CP with $LEMUR_ORG_CP from the env

# Want this wrapper to work for both deployed apps, and local on dev's workstation
if [[ "$BASE" = /export/disk0/wb/bin/* ]]; then
  #CLASSPATH=$BASE/jars/wb-hadoop-java.jar:$BASE/lib/java/*
  _LEMUR_CP=""
  _DEPS_CP=$BASE/lib/java/*
  _ORG_CP=$BASE/jars/wb-hadoop-java.jar
else
  #CLASSPATH=$BASE/bin/target/classes:$BASE/bin/target/lib/*:$BASE/clj/wb-clj/src:$BASE/clj/wb-clj/classes:$BASE/clj/wb-clj/lib/*
  #_LEMUR_CP=$BASE/src/main/clj
  _LEMUR_CP=`echo $BASE/lemur-*.jar`
  _DEPS_CP=$BASE/lib/*
  _ORG_CP=$BASE/../../bin/target/classes:$BASE/../../bin/target/lib/*:$BASE/../wb-clj/lib/*:$BASE/../wb-clj/src
fi

CLASSPATH=$_LEMUR_CP:$_DEPS_CP:$_ORG_CP

LOCAL_LOG_FILE="-Dlog4j.configuration=file:$BASE/resources/log4j.properties"
cmd="$JAVA $LOCAL_LOG_FILE $JAVA_OPTS -cp $CLASSPATH lemur.core"
if [ "$1" == "dry-run" ]; then
  echo $cmd "$@"
fi
$cmd "$@"
